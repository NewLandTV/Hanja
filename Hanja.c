#include <stdio.h>
#include <time.h>
#include <string.h>
#include <stdlib.h>
#include "Hanja.h"

// Data
Hanja hanja[HANJA_COUNT] =
{
	// 8ÐäùÓí® 
	{ "Îè", "±³" },
	{ "Îç", "±³" },
	{ "Îú", "±¸" },
	{ "ÏÐ", "±¹" },
	{ "ÏÚ", "±º" },
	{ "ÑÑ", "±Ý, ±è" },
	{ "Ñõ", "³²" },
	{ "Ò³", "³à" },
	{ "Ò´", "³â" },
	{ "ÓÞ", "´ë" },
	{ "ÔÔ", "µ¿" },
	{ "×¿", "·ú" },
	{ "Ø¿", "¸¸" },
	{ "Ù½", "¸ð" },
	{ "ÙÊ", "¸ñ" },
	{ "Ú¦", "¹®" },
	{ "ÚÅ", "¹Î" },
	{ "ÛÜ", "¹é" },
	{ "Ý«", "ºÎ" },
	{ "ÝÁ", "ºÏ, ¹è" },
	{ "ÞÌ", "»ç" },
	{ "ß£", "»ê" },
	{ "ß²", "»ï" },
	{ "ßæ", "»ý" },
	{ "à¤", "¼­" },
	{ "à»", "¼±" },
	{ "á³", "¼Ò" },
	{ "â©", "¼ö" },
	{ "ãø", "½Ç" },
	{ "ä¨", "½Ê" },
	{ "çé", "¿À" },
	{ "èÝ", "¿Õ" },
	{ "èâ", "¿Ü" },
	{ "êÅ", "¿ù" },
	{ "ì£", "ÀÌ" },
	{ "ìÑ", "ÀÎ" },
	{ "ìé", "ÀÏ" },
	{ "ìí", "ÀÏ" },
	{ "íþ", "Àå" },
	{ "ð©", "Á¦" },
	{ "ñé", "Áß" },
	{ "ôì", "Ã»" },
	{ "õ»", "ÃÌ" },
	{ "öÒ", "Ä¥" },
	{ "÷Ï", "Åä" },
	{ "ø¢", "ÆÈ" },
	{ "ùÊ", "ÇÐ" },
	{ "ùÛ", "ÇÑ" },
	{ "úü", "Çü" },
	{ "ûý", "È­" },
	
	// 7ÐäIIùÓí® 
	{ "Ê«", "°¡" },
	{ "Êà", "°£" },
	{ "Ë°", "°­" },
	{ "ó³", "°Å, Â÷" },
	{ "Íï", "°ø" },
	{ "Íö", "°ø" },
	{ "Ñ¨", "±â" },
	{ "ÑÀ", "±â" },
	{ "Ñû", "³²" },
	{ "Ò®", "³»" },
	{ "ÒÜ", "³ó" },
	{ "ÓÍ", "´ä" },
	{ "Ô³", "µµ" },
	{ "ÔÑ", "µ¿" },
	{ "Õô", "·Â" },
	{ "Ø¡", "¸³" },
	{ "Øß", "¸Å" },
	{ "Ù£", "¸í" },
	{ "Úª", "¹°" },
	{ "Û°", "¹æ" },
	{ "Üô", "ºÒ" },
	{ "ÞÀ", "»ç" },
	{ "ß¾", "»ó" },
	{ "àó", "¼º" },
	{ "á¦", "¼¼" },
	{ "â¢", "¼ö" },
	{ "ãÁ", "½Ã" },
	{ "ã¼", "½Ã" },
	{ "ãÝ", "½Ä" },
	{ "äÌ", "¾È" },
	{ "çí", "¿À" },
	{ "éÓ", "¿À" },
	{ "í­", "ÀÚ" },
	{ "í»", "ÀÚ" },
	{ "íÞ", "Àå" },
	{ "ï³", "Àü" },
	{ "îñ", "Àü" },
	{ "îï", "Àü" },
	{ "ïá", "Á¤" },
	{ "ðë", "Á·" },
	{ "ñ§", "ÁÂ" },
	{ "òÁ", "Á÷" },
	{ "øÁ", "Æò" },
	{ "ù»", "ÇÏ" },
	{ "ùÓ", "ÇÑ" },
	{ "ú­", "ÇØ" },
	{ "ü¥", "È­" },
	{ "üÀ", "È°" },
	{ "üø", "È¿" },
	{ "ý­", "ÈÄ" },
	
	// 7ÐäùÓí® 
	{ "Ê°", "°¡" },
	{ "Ï¢", "±¸" },
	{ "Ðý", "±â" },
	{ "ÔÒ", "µ¿" },
	{ "Ô×", "µ¿, Åë" },
	{ "ÔÏ", "µ¿" },
	{ "Ôô", "µî" },
	{ "ÕÎ", "·¡" },
	{ "ÖÕ", "·Î" },
	{ "×ì", "¸®" },
	{ "×ù", "¸²" },
	{ "Øü", "¸é" },
	{ "Ù¤", "¸í" },
	{ "Ùþ", "¹®" },
	{ "Ùý", "¹®" },
	{ "ÛÝ", "¹é" },
	{ "Üý", "ºÎ" },
	{ "ß©", "»ê" },
	{ "ßä", "»ö" },
	{ "àª", "¼®" },
	{ "á´", "¼Ò" },
	{ "á¶", "¼Ò" },
	{ "â¦", "¼ö" },
	{ "ãÕ", "½Ä" },
	{ "ãý", "½É" },
	{ "åÞ", "¾î" },
	{ "æÔ", "¿¬" },
	{ "êó", "À¯" },
	{ "ëÀ", "À°" },
	{ "ëé", "À¾" },
	{ "ìý", "ÀÔ" },
	{ "í®", "ÀÚ" },
	{ "ðÓ", "Á¶" },
	{ "ñ¬", "ÁÖ" },
	{ "ñ«", "ÁÖ" },
	{ "ñì", "Áß" },
	{ "òµ", "Áö" },
	{ "ò¢", "Áö" },
	{ "ô¶", "Ãµ" },
	{ "ô¸", "Ãµ" },
	{ "ô¹", "Ãµ" },
	{ "õ®", "ÃÊ" },
	{ "õ½", "ÃÌ" },
	{ "õÕ", "Ãß" },
	{ "õð", "Ãá" },
	{ "õó", "Ãâ" },
	{ "øµ", "Æí, º¯" },
	{ "ù¾", "ÇÏ" },
	{ "ü£", "È­" },
	{ "ýÌ", "ÈÞ" },
	
	// 6ÐäIIùÓí® 
	{ "ÊÀ", "°¢" },
	{ "ÊÇ", "°¢" },
	{ "Í£", "°è" },
	{ "Íª", "°è" },
	{ "ÍÔ", "°í" },
	{ "Íë", "°ø" },
	{ "Íì", "°ø" },
	{ "Íí", "°ø" },
	{ "Íý", "°ú" },
	{ "Î¡", "°ú" },
	{ "ÎÃ", "±¤" },
	{ "Ï¹", "±¸" },
	{ "ÐÑ", "±Ý" },
	{ "Ðá", "±Þ" },
	{ "Ó­", "´Ü" },
	{ "ÓÑ", "´ç" },
	{ "ÓÛ", "´ë" },
	{ "Óß", "´ë" },
	{ "Óñ", "µµ" },
	{ "ÔÁ", "µ¶, µÎ" },
	{ "ÔÛ", "µ¿" },
	{ "Ôõ", "µî" },
	{ "äÅ", "¶ô, ¾Ç, ¿ä" },
	{ "××", "¸®" },
	{ "×â", "¸®" },
	{ "Ù¥", "¸í" },
	{ "Ú¤", "¹®" },
	{ "Úâ", "¹Ý" },
	{ "Úã", "¹Ý" },
	{ "Úì", "¹Ý" },
	{ "Û¡", "¹ß" },
	{ "Û¯", "¹æ" },
	{ "Ý»", "ºÎ" },
	{ "ÝÂ", "ºÎ" },
	{ "Þä", "»ç" },
	{ "ßö", "¼­" },
	{ "àÊ", "¼±" },
	{ "àä", "¼³" },
	{ "à÷", "¼º" },
	{ "àý", "¼º, »ý" },
	{ "á¼", "¼Ò" },
	{ "âú", "¼ú" },
	{ "ã·", "½Ã" },
	{ "ãó", "½Å" },
	{ "ãê", "½Å" },
	{ "ãá", "½Å" },
	{ "ãæ", "½Å" },
	{ "å°", "¾à" },
	{ "å·", "¾à" },
	{ "åö", "¾÷" },
	{ "é¸", "¿ë" },
	{ "éÄ", "¿ë" },
	{ "ê¡", "¿î" },
	{ "ëå", "À½" },
	{ "ëæ", "À½" },
	{ "ëò", "ÀÇ" },
	{ "íÂ", "ÀÛ" },
	{ "íÆ", "ÀÛ" },
	{ "î¦", "Àç" },
	{ "îú", "Àü" },
	{ "ïÔ", "Á¤" },
	{ "ð¯", "Á¦" },
	{ "ð¹", "Á¦" },
	{ "ñ¼", "ÁÖ" },
	{ "ó¢", "Áý" },
	{ "óë", "Ã¢" },
	{ "ôè", "Ã»" },
	{ "ô÷", "Ã¼" },
	{ "øú", "Ç¥" },
	{ "ù¦", "Ç³" },
	{ "ú¹", "Çà" },
	{ "úÞ", "Çö" },
	{ "û¡", "Çü" },
	{ "ûú", "È­" },
	{ "üå", "È¸" },
	
	// 6ÐäùÓí® 
	{ "Êï", "°¨" },
	{ "?", "°­" },
	{ "ËÒ", "°³" },
	{ "ÌÈ", "°æ" },
	{ "Í¯", "°í" },
	{ "ÍÈ", "°í" },
	{ "Îß", "±³" },
	{ "Ï¡", "±¸" },
	{ "ÏÛ", "±º" },
	{ "ÐÆ", "±Ù" },
	{ "ÐÎ", "±Ù" },
	{ "Ðä", "±Þ" },
	{ "Òý", "´Ù" },
	{ "Óâ", "´ë" },
	{ "Óø", "µµ, Å¹" },
	{ "Ôé", "µÎ" },
	{ "ÖÇ", "·Ê" },
	{ "ÖÉ", "·Ê" },
	{ "ÖØ", "·Î" },
	{ "Öà", "·Ï" },
	{ "×Ý", "¸®" },
	{ "ÙÍ", "¸ñ" },
	{ "Ú¸", "¹Ì" },
	{ "Ú·", "¹Ì" },
	{ "ÚÓ", "¹Ú" },
	{ "Ûã", "¹ø" },
	{ "Ü¬", "º°" },
	{ "Ü» ", "º´" },
	{ "Ü×", "º¹" },
	{ "Üâ", "º»" },
	{ "ÞÅ", "»ç" },
	{ "ÞÝ", "»ç" },
	{ "à¬", "¼®" },
	{ "à´", "¼®" },
	{ "áÜ", "¼Ó" },
	{ "áÝ", "¼Õ" },
	{ "â§", "¼ö" },
	{ "ã§", "½À" },
	{ "ã­", "½Â" },
	{ "ãÒ", "½Ä" },
	{ "ã÷", "½Ç" },
	{ "äñ", "¾Ö" },
	{ "å¨", "¾ß" },
	{ "å¯", "¾ß" },
	{ "åÕ ", "¾ç" },
	{ "åÇ", "¾ç" },
	{ "åë", "¾ð" },
	{ "çÈ", "¿µ" },
	{ "çµ", "¿µ" },
	{ "è®", "¿Â" },
	{ "ê®", "¿ø" },
	{ "êÀ", "¿ø" },
	{ "ë¦", "À¯" },
	{ "êú", "À¯" },
	{ "ëÞ", "Àº" },
	{ "ì¢", "ÀÇ" },
	{ "ëý", "ÀÇ" },
	{ "íº", "ÀÚ" },
	{ "íñ", "Àå" },
	{ "î¤", "Àç" },
	{ "ïÒ", "Á¤" },
	{ "ðÈ", "Á¶" },
	{ "ðé", "Á·" },
	{ "ñ¸", "ÁÖ" },
	{ "öÑ", "Ä£" },
	{ "÷¼", "ÅÂ" },
	{ "÷×", "Åë" },
	{ "÷å", "Æ¯" },
	{ "ùê", "ÇÕ" },
	{ "ú¼", "Çà, Ç×" },
	{ "ú¾", "Çâ" },
	{ "ûÜ", "È£" },
	{ "ûþ", "È­, È¸" },
	{ "üÜ", "È²" },
	{ "ýº", "ÈÆ" },

	// 5ÐäIIùÓí® 
	{ "Ê¤", "°¡" },
	{ "ËÔ", "°´" },
	{ "Ì«", "°Ý" },
	{ "Ì¸", "°ß, Çö" },
	{ "Ì¿", "°á" },
	{ "Ì½", "°á" },
	{ "Ì×", "°æ" },
	{ "Í±", "°í" },
	{ "Î¤", "°ú" },
	{ "Î¦", "°ú" },
	{ "Îº", "°ü" },
	{ "Î¼", "°ü" },
	{ "ÎÆ", "±¤" },
	{ "Îý", "±¸" },
	{ "ÏÁ", "±¸" },
	{ "ÏÑ", "±¹" },
	{ "Ðñ", "±â" },
	{ "Ðù", "±â" },
	{ "Ò·", "³ä" },
	{ "Òö", "´É" },
	{ "Ó¥", "´Ü" },
	{ "Ó×", "´ç" },
	{ "Óì", "´ö" },
	{ "Óð", "µµ" },
	{ "Ô¼", "µ¶" },
	{ "ÕÇ", "¶û" },
	{ "ÕÞ", "·®" },
	{ "Õé", "·Á" },
	{ "Õö", "·Â" },
	{ "Ö£", "·Ã" },
	{ "ÖÌ", "·Î" },
	{ "×µ", "·ù" },
	{ "×¾", "·ù" },
	{ "×Á", "·ú" },
	{ "ØÐ", "¸Á" },
	{ "Ûö", "¹ý" },
	{ "Ü¨", "º¯" },
	{ "Ü²", "º´" },
	{ "ÜØ", "º¹" },
	{ "Üå", "ºÀ" },
	{ "ÞÈ", "»ç" },
	{ "ÞÍ", "»ç" },
	{ "ÞÂ", "»ç" },
	{ "ß§", "»ê" },
	{ "ßÂ", "»ó" },
	{ "ßÓ", "»ó" },
	{ "àØ", "¼±" },
	{ "à¹", "¼±" },
	{ "àã", "¼³, ¼¼" },
	{ "àõ", "¼º" },
	{ "á©", "¼¼" },
	{ "á¨", "¼¼" },
	{ "áÖ", "¼Ó" },
	{ "âÏ", "¼ö" },
	{ "âÖ", "¼÷, ¼ö" },
	{ "â÷", "¼ø" },
	{ "ãÛ", "½Ä" },
	{ "ãí", "½Å" },
	{ "ãù", "½Ç" },
	{ "ä®", "¾Æ" },
	{ "äÂ", "¾Ç, ¿À" },
	{ "å³", "¾à" },
	{ "å×", "¾ç" },
	{ "é©", "¿ä" },
	{ "éÒ", "ºÎ" },
	{ "éë", "¿ì" },
	{ "ê£", "¿î" },
	{ "êª", "¿ø" },
	{ "êÉ", "À§" },
	{ "ì¤", "ÀÌ" },
	{ "ìò", "ÀÓ" },
	{ "î¯", "Àç" },
	{ "î§", "Àç" },
	{ "îÜ", "Àû" },
	{ "îî", "Àü" },
	{ "îð", "Àü" },
	{ "î÷", "Àü" },
	{ "ï½", "Àý" },
	{ "ï·", "Àý, Ã¼" },
	{ "ïÁ", "Á¡" },
	{ "ï×", "Á¤" },
	{ "ðà", "Á¶" },
	{ "ðï", "Á¹" },
	{ "ðú", "Á¾" },
	{ "ñÎ", "ÁÖ" },
	{ "ñ¶", "ÁÖ" },
	{ "ò±", "Áö" },
	{ "òõ", "Áú" },
	{ "ó·", "Âø" },
	{ "óÑ", "Âü" },
	{ "ô¡", "Ã¥" },
	{ "õö", "Ãæ" },
	{ "Óë", "ÅÃ" },
	{ "ù¡", "Ç°" },
	{ "ù±", "ÇÊ" },
	{ "ù¶", "ÇÊ" },
	{ "úª", "ÇØ" },
	{ "ûù", "È­" },
	{ "üù", "È¿" },
	{ "ýÕ", "Èä" }
};

// To display the number of problems you have answered.
unsigned long long score;

void Init()
{
	srand((unsigned int)time(0));
	
	// Setup console
	system("title ùÓí®");
	system("mode con cols=60 lines=30");
	
	// Hide console cursor
	CONSOLE_CURSOR_INFO consoleCursorInfo;
	
	consoleCursorInfo.bVisible = 0;
	consoleCursorInfo.dwSize = 1;
	
	SetConsoleCursorInfo(GetStdHandle(STD_OUTPUT_HANDLE), &consoleCursorInfo);
}

void DrawTitle()
{
	Gotoxy(23, 1);
	fputs("¦£¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¤", stdout);
	Gotoxy(23, 2);
	fputs("¦¢   ùÓí®   ¦¢", stdout);
	Gotoxy(23, 3);
	fputs("¦¢   ãËúÐ   ¦¢", stdout);
	Gotoxy(23, 4);
	fputs("¦¦¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¥", stdout);
	Gotoxy(16, 10);
	fputs("- PRESS ANY KEY TO START -", stdout);
	Gotoxy(1, 28);
	fputs("v0.6.0", stdout);
	Gotoxy(0, 0);
}

void DrawScore()
{
	Gotoxy(32, 1);
	fprintf(stdout, "SCORE : %llu", score);
	Gotoxy(0, 2);
}

// Problems
void Problem1()
{
	int i;
	int pr;
	int index = rand() % HANJA_COUNT;
	char input[3];
	char output[3];
	
	fputs("ó­ªÎùÓí®ªÎëåÔÁªòßöª¤ªÆª¯ªÀªµª¤¡£\n", stdout);
	fputs(hanja[index].data, stdout);
	fputc('\n', stdout);
	scanf("%s", input);
	
	// Check answer
	pr = GetPronunciation(index, 0, output);
	
	if (pr == 2)
	{
		if (CheckAnswer(output, input))
		{
			return;
		}
		
		fputs("è¦ÓÍ!\n", stdout);
		
		return;
	}
	
	for (i = 0; ; i++)
	{
		pr = GetPronunciation(index, i, output);
		
		if (pr == 0)
		{
			break;
		}
		
		if (CheckAnswer(output, input))
		{
			return;
		}
	}
	
	fputs("è¦ÓÍ!\n", stdout);
}

void Problem2()
{
	int i, j;
	int pr;
	int index = -1;
	int input;
	char output[3];
	
	Hanja list[4];
	
	// Choice 4 hanjas to display on the screen.
	for (i = 0; i < 4; i++)
	{
		if (rand() & 1 && index == -1)
		{
			index = rand() % HANJA_COUNT - 1;
			list[i] = hanja[index];
		}
		else
		{
			list[i] = hanja[rand() % HANJA_COUNT - 1];
		}
		
		for (j = 0; j < i; j++)
		{
			if (strcmp(list[i].data, list[j].data) == 0)
			{
				j--;
				list[j] = hanja[rand() % HANJA_COUNT - 1];
				
				continue;
			}
		}
	}
	
	// Show and Input
	fputs("ó­ªÎùÓí®ªÎëåÔÁªËõÌªâÕÞª¤ªâªÎªò1 ª«ªé4ªÎñéª«ªéìéªÄàÔªóªÇª¯ªÀªµª¤¡£\n", stdout);
	fputs(hanja[index].data, stdout);
	fputc('\n', stdout);
	
	for (i = 0; i < 4; i++)
	{
		fprintf(stdout, "%d. %s\n", i + 1, list[i].pronunciation);
	}
	
	scanf("%d", &input);
	
	// Check answer
	pr = GetPronunciation(index, 0, output);
	i = 0;
	
	if (pr == 2)
	{
		if (CheckAnswer(output, list[input - 1].pronunciation))
		{
			return;
		}
		
		fputs("è¦ÓÍ!\n", stdout);
		
		return;
	}
	
	while (1)
	{
		pr = GetPronunciation(index, i, output);
		
		if (pr == 0)
		{
			break;
		}
		
		if (CheckAnswer(output, list[input - 1].pronunciation))
		{
			return;
		}
		
		i++;
	}
	
	fputs("è¦ÓÍ!\n", stdout);
}

// Hanja data functions
int CheckAnswer(char* answer, char* input)
{
	if (strcmp(answer, input) != 0)
	{
		return 0;
	}
	
	score++;
	
	fputs("ïáÓÍ!\n", stdout);
	
	return 1;
}

int GetPronunciation(int index, int pronunciationIndex, char* out)
{
	Hanja ptr = hanja[index];
	
	int i;
	char* temp;
	
	// Only one pronunciation.
	if (strlen(ptr.pronunciation) <= 3)
	{
		strcpy(out, ptr.pronunciation);
		
		return 2;
	}
	
	temp = strtok(ptr.pronunciation, ", ");
	
	for (i = 0; i < pronunciationIndex; i++)
	{
		temp = strtok(NULL, ", ");
		
		if (temp == NULL)
		{
			return 0;
		}
	}
	
	strcpy(out, temp);
	
	return 1;
}
